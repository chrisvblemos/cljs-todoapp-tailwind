shadow$provide.module$node_modules$rc_field_form$lib$Field=function(global,require,module,exports){function requireUpdate(shouldUpdate,prev,next,prevValue,nextValue,info){return"function"===typeof shouldUpdate?shouldUpdate(prev,next,"source"in info?{source:info.source}:{}):prevValue!==nextValue}global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault").default;module=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard").default;Object.defineProperty(exports,
"__esModule",{value:!0});exports.default=void 0;var _extends2=global(require("module$node_modules$$babel$runtime$helpers$extends")),_objectWithoutProperties2=global(require("module$node_modules$$babel$runtime$helpers$objectWithoutProperties")),_regeneratorRuntime2=global(require("module$node_modules$$babel$runtime$helpers$regeneratorRuntime")),_asyncToGenerator2=global(require("module$node_modules$$babel$runtime$helpers$asyncToGenerator")),_objectSpread2=global(require("module$node_modules$$babel$runtime$helpers$objectSpread2")),
_toConsumableArray2=global(require("module$node_modules$$babel$runtime$helpers$toConsumableArray")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_assertThisInitialized2=global(require("module$node_modules$$babel$runtime$helpers$assertThisInitialized")),_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits")),_createSuper2=global(require("module$node_modules$$babel$runtime$helpers$createSuper")),
_defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_toArray=global(require("module$node_modules$rc_util$lib$Children$toArray")),_isEqual=global(require("module$node_modules$rc_util$lib$isEqual")),_warning=global(require("module$node_modules$rc_util$lib$warning")),React=module(require("module$node_modules$react$index")),_FieldContext=module(require("module$node_modules$rc_field_form$lib$FieldContext")),_ListContext=global(require("module$node_modules$rc_field_form$lib$ListContext")),
_typeUtil=require("module$node_modules$rc_field_form$lib$utils$typeUtil"),_validateUtil=require("module$node_modules$rc_field_form$lib$utils$validateUtil"),_valueUtil=require("module$node_modules$rc_field_form$lib$utils$valueUtil"),_excluded=["name"],EMPTY_ERRORS=[],Field=function(_React$Component){function Field(props){(0,_classCallCheck2.default)(this,Field);var _this=_super.call(this,props);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"state",{resetCount:0});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),
"cancelRegisterFunc",null);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"mounted",!1);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"touched",!1);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"dirty",!1);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"validatePromise",void 0);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"prevValidating",void 0);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),
"errors",EMPTY_ERRORS);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"warnings",EMPTY_ERRORS);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"cancelRegister",function(){var _this$props=_this.props,preserve=_this$props.preserve,isListField=_this$props.isListField;_this$props=_this$props.name;_this.cancelRegisterFunc&&_this.cancelRegisterFunc(isListField,preserve,(0,_valueUtil.getNamePath)(_this$props));_this.cancelRegisterFunc=null});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),
"getNamePath",function(){var _this$props2=_this.props,name=_this$props2.name;_this$props2=_this$props2.fieldContext.prefixName;_this$props2=void 0===_this$props2?[]:_this$props2;return void 0!==name?[].concat((0,_toConsumableArray2.default)(_this$props2),(0,_toConsumableArray2.default)(name)):[]});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"getRules",function(){var _this$props3=_this.props,_this$props3$rules=_this$props3.rules,fieldContext=_this$props3.fieldContext;return(void 0===
_this$props3$rules?[]:_this$props3$rules).map(function(rule){return"function"===typeof rule?rule(fieldContext):rule})});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"refresh",function(){_this.mounted&&_this.setState(function(_ref){return{resetCount:_ref.resetCount+1}})});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"metaCache",null);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"triggerMetaEvent",function(destroy){var onMetaChange=
_this.props.onMetaChange;onMetaChange?(destroy=(0,_objectSpread2.default)((0,_objectSpread2.default)({},_this.getMeta()),{},{destroy}),(0,_isEqual.default)(_this.metaCache,destroy)||onMetaChange(destroy),_this.metaCache=destroy):_this.metaCache=null});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onStoreChange",function(prevStore,namePathList,info){var _this$props4=_this.props,shouldUpdate=_this$props4.shouldUpdate,_this$props4$dependen=_this$props4.dependencies;_this$props4$dependen=
void 0===_this$props4$dependen?[]:_this$props4$dependen;var onReset=_this$props4.onReset;_this$props4=info.store;var namePath=_this.getNamePath(),prevValue=_this.getValue(prevStore),curValue=_this.getValue(_this$props4),namePathMatch=namePathList&&(0,_valueUtil.containsNamePath)(namePathList,namePath);"valueUpdate"!==info.type||"external"!==info.source||(0,_isEqual.default)(prevValue,curValue)||(_this.touched=!0,_this.dirty=!0,_this.validatePromise=null,_this.errors=EMPTY_ERRORS,_this.warnings=EMPTY_ERRORS,
_this.triggerMetaEvent());switch(info.type){case "reset":if(!namePathList||namePathMatch){_this.touched=!1;_this.dirty=!1;_this.validatePromise=void 0;_this.errors=EMPTY_ERRORS;_this.warnings=EMPTY_ERRORS;_this.triggerMetaEvent();null===onReset||void 0===onReset||onReset();_this.refresh();return}break;case "remove":if(shouldUpdate&&requireUpdate(shouldUpdate,prevStore,_this$props4,prevValue,curValue,info)){_this.reRender();return}break;case "setField":_this$props4$dependen=info.data;if(namePathMatch){"touched"in
_this$props4$dependen&&(_this.touched=_this$props4$dependen.touched);"validating"in _this$props4$dependen&&!("originRCField"in _this$props4$dependen)&&(_this.validatePromise=_this$props4$dependen.validating?Promise.resolve([]):null);"errors"in _this$props4$dependen&&(_this.errors=_this$props4$dependen.errors||EMPTY_ERRORS);"warnings"in _this$props4$dependen&&(_this.warnings=_this$props4$dependen.warnings||EMPTY_ERRORS);_this.dirty=!0;_this.triggerMetaEvent();_this.reRender();return}if("value"in _this$props4$dependen&&
(0,_valueUtil.containsNamePath)(namePathList,namePath,!0)){_this.reRender();return}if(shouldUpdate&&!namePath.length&&requireUpdate(shouldUpdate,prevStore,_this$props4,prevValue,curValue,info)){_this.reRender();return}break;case "dependenciesUpdate":if(_this$props4$dependen.map(_valueUtil.getNamePath).some(function(dependency){return(0,_valueUtil.containsNamePath)(info.relatedFields,dependency)})){_this.reRender();return}break;default:if(namePathMatch||(!_this$props4$dependen.length||namePath.length||
shouldUpdate)&&requireUpdate(shouldUpdate,prevStore,_this$props4,prevValue,curValue,info)){_this.reRender();return}}!0===shouldUpdate&&_this.reRender()});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"validateRules",function(options){var namePath=_this.getNamePath(),currentValue=_this.getValue(),_ref2=options||{},triggerName=_ref2.triggerName;_ref2=_ref2.validateOnly;_ref2=void 0===_ref2?!1:_ref2;var rootPromise=Promise.resolve().then((0,_asyncToGenerator2.default)((0,_regeneratorRuntime2.default)().mark(function _callee(){var _this$props5,
_this$props5$validate,validateFirst,messageVariables,validateDebounce,filteredRules,promise;return(0,_regeneratorRuntime2.default)().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_this.mounted){_context.next=2;break}return _context.abrupt("return",[]);case 2:_this$props5=_this.props;_this$props5$validate=_this$props5.validateFirst;validateFirst=void 0===_this$props5$validate?!1:_this$props5$validate;messageVariables=_this$props5.messageVariables;validateDebounce=_this$props5.validateDebounce;
filteredRules=_this.getRules();triggerName&&(filteredRules=filteredRules.filter(function(rule){return rule}).filter(function(rule){return(rule=rule.validateTrigger)?(0,_typeUtil.toArray)(rule).includes(triggerName):!0}));if(!validateDebounce||!triggerName){_context.next=10;break}_context.next=8;return new Promise(function(resolve){setTimeout(resolve,validateDebounce)});case 8:if(_this.validatePromise===rootPromise){_context.next=10;break}return _context.abrupt("return",[]);case 10:return promise=
(0,_validateUtil.validateRules)(namePath,currentValue,filteredRules,options,validateFirst,messageVariables),promise.catch(function(e){return e}).then(function(){var ruleErrors=0<arguments.length&&void 0!==arguments[0]?arguments[0]:EMPTY_ERRORS;if(_this.validatePromise===rootPromise){var _ruleErrors$forEach;_this.validatePromise=null;var nextErrors=[],nextWarnings=[];null===(_ruleErrors$forEach=ruleErrors.forEach)||void 0===_ruleErrors$forEach||_ruleErrors$forEach.call(ruleErrors,function(_ref4){var _ref4$errors=
_ref4.errors;_ref4$errors=void 0===_ref4$errors?EMPTY_ERRORS:_ref4$errors;_ref4.rule.warningOnly?nextWarnings.push.apply(nextWarnings,(0,_toConsumableArray2.default)(_ref4$errors)):nextErrors.push.apply(nextErrors,(0,_toConsumableArray2.default)(_ref4$errors))});_this.errors=nextErrors;_this.warnings=nextWarnings;_this.triggerMetaEvent();_this.reRender()}}),_context.abrupt("return",promise);case 13:case "end":return _context.stop()}},_callee)})));if(_ref2)return rootPromise;_this.validatePromise=
rootPromise;_this.dirty=!0;_this.errors=EMPTY_ERRORS;_this.warnings=EMPTY_ERRORS;_this.triggerMetaEvent();_this.reRender();return rootPromise});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"isFieldValidating",function(){return!!_this.validatePromise});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"isFieldTouched",function(){return _this.touched});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"isFieldDirty",function(){if(_this.dirty||
void 0!==_this.props.initialValue)return!0;var getInitialValue=_this.props.fieldContext.getInternalHooks(_FieldContext.HOOK_MARK).getInitialValue;return void 0!==getInitialValue(_this.getNamePath())?!0:!1});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"getErrors",function(){return _this.errors});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"getWarnings",function(){return _this.warnings});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),
"isListField",function(){return _this.props.isListField});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"isList",function(){return _this.props.isList});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"isPreserve",function(){return _this.props.preserve});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"getMeta",function(){_this.prevValidating=_this.isFieldValidating();return{touched:_this.isFieldTouched(),validating:_this.prevValidating,
errors:_this.errors,warnings:_this.warnings,name:_this.getNamePath(),validated:null===_this.validatePromise}});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"getOnlyChild",function(children){if("function"===typeof children){var _meta2=_this.getMeta();return(0,_objectSpread2.default)((0,_objectSpread2.default)({},_this.getOnlyChild(children(_this.getControlled(),_meta2,_this.props.fieldContext))),{},{isFunction:!0})}children=(0,_toArray.default)(children);return 1===children.length&&
React.isValidElement(children[0])?{child:children[0],isFunction:!1}:{child:children,isFunction:!1}});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"getValue",function(store){var getFieldsValue=_this.props.fieldContext.getFieldsValue,namePath=_this.getNamePath();return(0,_valueUtil.getValue)(store||getFieldsValue(!0),namePath)});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"getControlled",function(){var childProps=0<arguments.length&&void 0!==arguments[0]?
arguments[0]:{},_this$props6=_this.props,name=_this$props6.name,trigger=_this$props6.trigger,validateTrigger=_this$props6.validateTrigger,getValueFromEvent=_this$props6.getValueFromEvent,normalize=_this$props6.normalize,valuePropName=_this$props6.valuePropName,getValueProps=_this$props6.getValueProps;_this$props6=_this$props6.fieldContext;validateTrigger=void 0!==validateTrigger?validateTrigger:_this$props6.validateTrigger;var namePath=_this.getNamePath(),getInternalHooks=_this$props6.getInternalHooks,
getFieldsValue=_this$props6.getFieldsValue,dispatch=getInternalHooks(_FieldContext.HOOK_MARK).dispatch,value=_this.getValue();getValueProps=getValueProps||function(val){return(0,_defineProperty2.default)({},valuePropName,val)};var originTriggerFunc=childProps[trigger],valueProps=void 0!==name?getValueProps(value):{};valueProps&&Object.keys(valueProps).forEach(function(key){(0,_warning.default)("function"!==typeof valueProps[key],"It's not recommended to generate dynamic function prop by `getValueProps`. Please pass it to child component directly (prop: ".concat(key,
")"))});var control=(0,_objectSpread2.default)((0,_objectSpread2.default)({},childProps),valueProps);control[trigger]=function(){_this.touched=!0;_this.dirty=!0;_this.triggerMetaEvent();var newValue=arguments.length;for(var args=Array(newValue),_key=0;_key<newValue;_key++)args[_key]=arguments[_key];newValue=getValueFromEvent?getValueFromEvent.apply(void 0,args):_valueUtil.defaultGetValueFromEvent.apply(void 0,[valuePropName].concat(args));normalize&&(newValue=normalize(newValue,value,getFieldsValue(!0)));
newValue!==value&&dispatch({type:"updateValue",namePath,value:newValue});originTriggerFunc&&originTriggerFunc.apply(void 0,args)};(0,_typeUtil.toArray)(validateTrigger||[]).forEach(function(triggerName){var originTrigger=control[triggerName];control[triggerName]=function(){originTrigger&&originTrigger.apply(void 0,arguments);var rules=_this.props.rules;rules&&rules.length&&dispatch({type:"validateField",namePath,triggerName})}});return control});props.fieldContext&&(props=props.fieldContext.getInternalHooks,
props=props(_FieldContext.HOOK_MARK).initEntityValue,props((0,_assertThisInitialized2.default)(_this)));return _this}(0,_inherits2.default)(Field,_React$Component);var _super=(0,_createSuper2.default)(Field);(0,_createClass2.default)(Field,[{key:"componentDidMount",value:function(){var _this$props7=this.props,shouldUpdate=_this$props7.shouldUpdate;_this$props7=_this$props7.fieldContext;this.mounted=!0;_this$props7&&(_this$props7=_this$props7.getInternalHooks,_this$props7=_this$props7(_FieldContext.HOOK_MARK).registerField,
this.cancelRegisterFunc=_this$props7(this));!0===shouldUpdate&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister();this.triggerMetaEvent(!0);this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var resetCount=this.state.resetCount,_this$getOnlyChild=this.getOnlyChild(this.props.children),child=_this$getOnlyChild.child;_this$getOnlyChild.isFunction?_this$getOnlyChild=child:React.isValidElement(child)?_this$getOnlyChild=
React.cloneElement(child,this.getControlled(child.props)):((0,_warning.default)(!child,"`children` of Field is not validate ReactElement."),_this$getOnlyChild=child);return React.createElement(React.Fragment,{key:resetCount},_this$getOnlyChild)}}]);return Field}(React.Component);(0,_defineProperty2.default)(Field,"contextType",_FieldContext.default);(0,_defineProperty2.default)(Field,"defaultProps",{trigger:"onChange",valuePropName:"value"});exports.default=function(_ref6){var _restProps$isListFiel,
name=_ref6.name;_ref6=(0,_objectWithoutProperties2.default)(_ref6,_excluded);var fieldContext=React.useContext(_FieldContext.default),listContext=React.useContext(_ListContext.default);name=void 0!==name?(0,_valueUtil.getNamePath)(name):void 0;var isMergedListField=null!==(_restProps$isListFiel=_ref6.isListField)&&void 0!==_restProps$isListFiel?_restProps$isListFiel:!!listContext;_restProps$isListFiel="keep";isMergedListField||(_restProps$isListFiel="_".concat((name||[]).join("_")));!1===_ref6.preserve&&
isMergedListField&&1>=name.length&&(0,_warning.default)(!1,"`preserve` should not apply on Form.List fields.");return React.createElement(Field,(0,_extends2.default)({key:_restProps$isListFiel,name,isListField:isMergedListField},_ref6,{fieldContext}))}}
//# sourceMappingURL=module$node_modules$rc_field_form$lib$Field.js.map
