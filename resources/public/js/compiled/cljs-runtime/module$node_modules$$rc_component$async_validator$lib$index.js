shadow$provide.module$node_modules$$rc_component$async_validator$lib$index=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault").default;Object.defineProperty(exports,"__esModule",{value:!0});var _exportNames={};exports.default=void 0;var _objectSpread2=global(require("module$node_modules$$babel$runtime$helpers$objectSpread2")),_toConsumableArray2=global(require("module$node_modules$$babel$runtime$helpers$toConsumableArray")),_typeof2=
global(require("module$node_modules$$babel$runtime$helpers$typeof")),_classCallCheck2=global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),_messages2=require("module$node_modules$$rc_component$async_validator$lib$messages"),_util=require("module$node_modules$$rc_component$async_validator$lib$util"),
_index=global(require("module$node_modules$$rc_component$async_validator$lib$validator$index")),_interface=require("module$node_modules$$rc_component$async_validator$lib$interface");Object.keys(_interface).forEach(function(key){"default"!==key&&"__esModule"!==key&&(Object.prototype.hasOwnProperty.call(_exportNames,key)||key in exports&&exports[key]===_interface[key]||Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _interface[key]}}))});require=function(){function Schema(descriptor){(0,_classCallCheck2.default)(this,
Schema);(0,_defineProperty2.default)(this,"rules",null);(0,_defineProperty2.default)(this,"_messages",_messages2.messages);this.define(descriptor)}(0,_createClass2.default)(Schema,[{key:"define",value:function(rules){var _this=this;if(!rules)throw Error("Cannot configure a schema with no rules");if("object"!==(0,_typeof2.default)(rules)||Array.isArray(rules))throw Error("Rules must be an object");this.rules={};Object.keys(rules).forEach(function(name){var item=rules[name];_this.rules[name]=Array.isArray(item)?
item:[item]})}},{key:"messages",value:function(_messages){_messages&&(this._messages=(0,_util.deepMerge)((0,_messages2.newMessages)(),_messages));return this._messages}},{key:"validate",value:function(source_){var _this2=this,source=source_,options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},callback=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){};"function"===typeof options&&(callback=options,options={});if(!this.rules||0===Object.keys(this.rules).length)return callback&&
callback(null,source),Promise.resolve(source);if(options.messages){var messages=this.messages();messages===_messages2.messages&&(messages=(0,_messages2.newMessages)());(0,_util.deepMerge)(messages,options.messages);options.messages=messages}else options.messages=this.messages();var series={};(options.keys||Object.keys(this.rules)).forEach(function(z){var value=source[z];_this2.rules[z].forEach(function(r){"function"===typeof r.transform&&(source===source_&&(source=(0,_objectSpread2.default)({},source)),
value=source[z]=r.transform(value),void 0!==value&&null!==value&&(r.type=r.type||(Array.isArray(value)?"array":(0,_typeof2.default)(value))));r="function"===typeof r?{validator:r}:(0,_objectSpread2.default)({},r);r.validator=_this2.getValidationMethod(r);r.validator&&(r.field=z,r.fullField=r.fullField||z,r.type=_this2.getType(r),series[z]=series[z]||[],series[z].push({rule:r,value,source,field:z}))})});return(0,_util.asyncMap)(series,options,function(data,doIt){function addFullField(key,schema){return(0,_objectSpread2.default)((0,_objectSpread2.default)({},
schema),{},{fullField:"".concat(rule.fullField,".").concat(key),fullFields:rule.fullFields?[].concat((0,_toConsumableArray2.default)(rule.fullFields),[key]):[key]})}function cb(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];e=Array.isArray(e)?e:[e];!options.suppressWarning&&e.length&&Schema.warning("async-validator:",e);e.length&&void 0!==rule.message&&(e=[].concat(rule.message));var filledErrors=e.map((0,_util.complementError)(rule,source));if(options.first&&filledErrors.length)return doIt(filledErrors);
if(deep){if(rule.required&&!data.value)return void 0!==rule.message?filledErrors=[].concat(rule.message).map((0,_util.complementError)(rule,source)):options.error&&(filledErrors=[options.error(rule,(0,_util.format)(options.messages.required,rule.field))]),doIt(filledErrors);var fieldsSchema={};rule.defaultField&&Object.keys(data.value).map(function(key){fieldsSchema[key]=rule.defaultField});fieldsSchema=(0,_objectSpread2.default)((0,_objectSpread2.default)({},fieldsSchema),data.rule.fields);var paredFieldsSchema=
{};Object.keys(fieldsSchema).forEach(function(field){var fieldSchema=fieldsSchema[field];fieldSchema=Array.isArray(fieldSchema)?fieldSchema:[fieldSchema];paredFieldsSchema[field]=fieldSchema.map(addFullField.bind(null,field))});e=new Schema(paredFieldsSchema);e.messages(options.messages);data.rule.options&&(data.rule.options.messages=options.messages,data.rule.options.error=options.error);e.validate(data.value,data.rule.options||options,function(errs){var finalErrors=[];filledErrors&&filledErrors.length&&
finalErrors.push.apply(finalErrors,(0,_toConsumableArray2.default)(filledErrors));errs&&errs.length&&finalErrors.push.apply(finalErrors,(0,_toConsumableArray2.default)(errs));doIt(finalErrors.length?finalErrors:null)})}else doIt(filledErrors)}var rule=data.rule,deep=("object"===rule.type||"array"===rule.type)&&("object"===(0,_typeof2.default)(rule.fields)||"object"===(0,_typeof2.default)(rule.defaultField));deep=deep&&(rule.required||!rule.required&&data.value);rule.field=data.field;if(rule.asyncValidator)var res=
rule.asyncValidator(rule,data.value,cb,data.source,options);else if(rule.validator){try{res=rule.validator(rule,data.value,cb,data.source,options)}catch(error){var _console$error,_console;null===(_console$error=(_console=console).error)||void 0===_console$error||_console$error.call(_console,error);options.suppressValidatorError||setTimeout(function(){throw error;},0);cb(error.message)}!0===res?cb():!1===res?cb("function"===typeof rule.message?rule.message(rule.fullField||rule.field):rule.message||
"".concat(rule.fullField||rule.field," fails")):res instanceof Array?cb(res):res instanceof Error&&cb(res.message)}res&&res.then&&res.then(function(){return cb()},function(e){return cb(e)})},function(results){for(var errors=[],i=0;i<results.length;i++){var _errors=void 0,e=results[i];Array.isArray(e)?errors=(_errors=errors).concat.apply(_errors,(0,_toConsumableArray2.default)(e)):errors.push(e)}errors.length?(results=(0,_util.convertFieldsError)(errors),callback(errors,results)):callback(null,source)},
source)}},{key:"getType",value:function(rule){void 0===rule.type&&rule.pattern instanceof RegExp&&(rule.type="pattern");if("function"!==typeof rule.validator&&rule.type&&!_index.default.hasOwnProperty(rule.type))throw Error((0,_util.format)("Unknown rule type %s",rule.type));return rule.type||"string"}},{key:"getValidationMethod",value:function(rule){if("function"===typeof rule.validator)return rule.validator;var keys=Object.keys(rule),messageIndex=keys.indexOf("message");-1!==messageIndex&&keys.splice(messageIndex,
1);return 1===keys.length&&"required"===keys[0]?_index.default.required:_index.default[this.getType(rule)]||void 0}}]);return Schema}();(0,_defineProperty2.default)(require,"register",function(type,validator){if("function"!==typeof validator)throw Error("Cannot register a validator by type, validator is not a function");_index.default[type]=validator});(0,_defineProperty2.default)(require,"warning",_util.warning);(0,_defineProperty2.default)(require,"messages",_messages2.messages);(0,_defineProperty2.default)(require,
"validators",_index.default);exports.default=require}
//# sourceMappingURL=module$node_modules$$rc_component$async_validator$lib$index.js.map
