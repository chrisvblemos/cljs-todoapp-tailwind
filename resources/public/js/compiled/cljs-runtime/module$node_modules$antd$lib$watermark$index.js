shadow$provide.module$node_modules$antd$lib$watermark$index=function(global,require,module,exports){"use client";global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard").default;module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault").default;Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _toConsumableArray2=module(require("module$node_modules$$babel$runtime$helpers$toConsumableArray")),_react=global(require("module$node_modules$react$index")),
_mutateObserver=require("module$node_modules$$rc_component$mutate_observer$lib$index"),_classnames=module(require("module$node_modules$classnames$index")),_useEvent=module(require("module$node_modules$rc_util$lib$hooks$useEvent")),_internal=require("module$node_modules$antd$lib$theme$internal"),_context=module(require("module$node_modules$antd$lib$watermark$context")),_useClips=global(require("module$node_modules$antd$lib$watermark$useClips")),_useRafDebounce=module(require("module$node_modules$antd$lib$watermark$useRafDebounce")),
_useWatermark=module(require("module$node_modules$antd$lib$watermark$useWatermark")),_utils=require("module$node_modules$antd$lib$watermark$utils"),_toList=module(require("module$node_modules$antd$lib$_util$toList"));const fixedStyle={position:"relative",overflow:"hidden"};require=props=>{var _a,_b;const {zIndex=9,rotate=-22,width,height,image,content,font={},style,className,rootClassName,gap=[100,100],offset,children,inherit=!0}=props,mergedStyle=Object.assign(Object.assign({},fixedStyle),style);
[,props]=(0,_internal.useToken)();const {color=props.colorFill,fontSize=props.fontSizeLG,fontWeight="normal",fontStyle="normal",fontFamily="sans-serif",textAlign="center"}=font,[gapX=100,gapY=100]=gap,gapXCenter=gapX/2,gapYCenter=gapY/2,offsetLeft=null!==(_a=null===offset||void 0===offset?void 0:offset[0])&&void 0!==_a?_a:gapXCenter,offsetTop=null!==(_b=null===offset||void 0===offset?void 0:offset[1])&&void 0!==_b?_b:gapYCenter;_a=_react.default.useMemo(()=>{const mergedMarkStyle={zIndex,position:"absolute",
left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let positionLeft=offsetLeft-gapXCenter,positionTop=offsetTop-gapYCenter;0<positionLeft&&(mergedMarkStyle.left=`${positionLeft}px`,mergedMarkStyle.width=`calc(100% - ${positionLeft}px)`,positionLeft=0);0<positionTop&&(mergedMarkStyle.top=`${positionTop}px`,mergedMarkStyle.height=`calc(100% - ${positionTop}px)`,positionTop=0);mergedMarkStyle.backgroundPosition=`${positionLeft}px ${positionTop}px`;return mergedMarkStyle},
[zIndex,offsetLeft,gapXCenter,offsetTop,gapYCenter]);const [container,setContainer]=_react.default.useState(),[subElements,setSubElements]=_react.default.useState(new Set),targetElements=_react.default.useMemo(()=>[].concat(container?[container]:[],(0,_toConsumableArray2.default)(Array.from(subElements))),[container,subElements]),getMarkSize=ctx=>{let defaultWidth=120;var defaultHeight=64;if(!image&&ctx.measureText){ctx.font=`${Number(fontSize)}px ${fontFamily}`;defaultHeight=(0,_toList.default)(content);
const sizes=defaultHeight.map(item=>{item=ctx.measureText(item);return[item.width,item.fontBoundingBoxAscent+item.fontBoundingBoxDescent]});defaultWidth=Math.ceil(Math.max.apply(Math,(0,_toConsumableArray2.default)(sizes.map(size=>size[0]))));defaultHeight=Math.ceil(Math.max.apply(Math,(0,_toConsumableArray2.default)(sizes.map(size=>size[1]))))*defaultHeight.length+(defaultHeight.length-1)*_useClips.FontGap}return[null!==width&&void 0!==width?width:defaultWidth,null!==height&&void 0!==height?height:
defaultHeight]},getClips=(0,_useClips.default)(),[watermarkInfo,setWatermarkInfo]=_react.default.useState(null),syncWatermark=(0,_useRafDebounce.default)(()=>{const ctx=document.createElement("canvas").getContext("2d");if(ctx){const ratio=(0,_utils.getPixelRatio)(),[markWidth,markHeight]=getMarkSize(ctx),drawCanvas=drawContent=>{const [nextClips,clipWidth]=getClips(drawContent||"",rotate,ratio,markWidth,markHeight,{color,fontSize,fontStyle,fontWeight,fontFamily,textAlign},gapX,gapY);setWatermarkInfo([nextClips,
clipWidth])};if(image){const img=new Image;img.onload=()=>{drawCanvas(img)};img.onerror=()=>{drawCanvas(content)};img.crossOrigin="anonymous";img.referrerPolicy="no-referrer";img.src=image}else drawCanvas(content)}}),[appendWatermark,removeWatermark,isWatermarkEle]=(0,_useWatermark.default)(_a);(0,_react.useEffect)(()=>{watermarkInfo&&targetElements.forEach(holder=>{appendWatermark(watermarkInfo[0],watermarkInfo[1],holder)})},[watermarkInfo,targetElements]);_a=(0,_useEvent.default)(mutations=>{mutations.forEach(mutation=>
{if((0,_utils.reRendering)(mutation,isWatermarkEle))syncWatermark();else if(mutation.target===container&&"style"===mutation.attributeName){mutation=Object.keys(fixedStyle);for(let i=0;i<mutation.length;i+=1){const key=mutation[i],oriValue=mergedStyle[key],currentValue=container.style[key];oriValue&&oriValue!==currentValue&&(container.style[key]=oriValue)}}})});(0,_mutateObserver.useMutateObserver)(targetElements,_a);(0,_react.useEffect)(syncWatermark,[rotate,zIndex,width,height,image,content,color,
fontSize,fontWeight,fontStyle,fontFamily,textAlign,gapX,gapY,offsetLeft,offsetTop]);_a=_react.default.useMemo(()=>({add:ele=>{setSubElements(prev=>{const clone=new Set(prev);clone.add(ele);return prev.size===clone.size?prev:clone})},remove:ele=>{removeWatermark(ele);setSubElements(prev=>{const clone=new Set(prev);clone.delete(ele);return prev.size===clone.size?prev:clone})}}),[]);_a=inherit?_react.default.createElement(_context.default.Provider,{value:_a},children):children;return _react.default.createElement("div",
{ref:setContainer,className:(0,_classnames.default)(className,rootClassName),style:mergedStyle},_a)};require.displayName="Watermark";exports.default=require}
//# sourceMappingURL=module$node_modules$antd$lib$watermark$index.js.map
