shadow$provide.module$node_modules$rc_upload$lib$AjaxUploader=function(global,require,module,exports){global=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault").default;module=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard").default;Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _extends2=global(require("module$node_modules$$babel$runtime$helpers$extends")),_objectSpread2=global(require("module$node_modules$$babel$runtime$helpers$objectSpread2")),
_objectWithoutProperties2=global(require("module$node_modules$$babel$runtime$helpers$objectWithoutProperties")),_typeof2=global(require("module$node_modules$$babel$runtime$helpers$typeof")),_regeneratorRuntime2=global(require("module$node_modules$$babel$runtime$helpers$regeneratorRuntime")),_asyncToGenerator2=global(require("module$node_modules$$babel$runtime$helpers$asyncToGenerator")),_toConsumableArray2=global(require("module$node_modules$$babel$runtime$helpers$toConsumableArray")),_classCallCheck2=
global(require("module$node_modules$$babel$runtime$helpers$classCallCheck")),_createClass2=global(require("module$node_modules$$babel$runtime$helpers$createClass")),_assertThisInitialized2=global(require("module$node_modules$$babel$runtime$helpers$assertThisInitialized")),_inherits2=global(require("module$node_modules$$babel$runtime$helpers$inherits")),_createSuper2=global(require("module$node_modules$$babel$runtime$helpers$createSuper")),_defineProperty2=global(require("module$node_modules$$babel$runtime$helpers$defineProperty")),
_classnames=global(require("module$node_modules$classnames$index")),_pickAttrs=global(require("module$node_modules$rc_util$lib$pickAttrs")),_react=module(require("module$node_modules$react$index")),_attrAccept=global(require("module$node_modules$rc_upload$lib$attr_accept")),_request=global(require("module$node_modules$rc_upload$lib$request")),_traverseFileTree=global(require("module$node_modules$rc_upload$lib$traverseFileTree")),_uid=global(require("module$node_modules$rc_upload$lib$uid")),_excluded=
"component prefixCls className classNames disabled id name style styles multiple accept capture children directory openFileDialogOnClick onMouseEnter onMouseLeave hasControlInside".split(" ");require=function(_Component){function AjaxUploader(){(0,_classCallCheck2.default)(this,AjaxUploader);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var _this=_super.call.apply(_super,[this].concat(args));(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),
"state",{uid:(0,_uid.default)()});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"reqs",{});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"fileInput",void 0);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"_isMounted",void 0);(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onChange",function(e){var _this$props=_this.props,accept=_this$props.accept,directory=_this$props.directory;e=(0,_toConsumableArray2.default)(e.target.files).filter(function(file){return!directory||
(0,_attrAccept.default)(file,accept)});_this.uploadFiles(e);_this.reset()});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onClick",function(event){var el=_this.fileInput;if(el){var target=event.target,onClick=_this.props.onClick;target&&"BUTTON"===target.tagName&&(el.parentNode.focus(),target.blur());el.click();onClick&&onClick(event)}});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onKeyDown",function(e){if("Enter"===e.key)_this.onClick(e)});
(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onFileDrop",function(){var _ref=(0,_asyncToGenerator2.default)((0,_regeneratorRuntime2.default)().mark(function _callee(e){var multiple,files,_files;return(0,_regeneratorRuntime2.default)().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:multiple=_this.props.multiple;e.preventDefault();if("dragover"!==e.type){_context.next=4;break}return _context.abrupt("return");case 4:if(!_this.props.directory){_context.next=
11;break}_context.next=7;return(0,_traverseFileTree.default)(Array.prototype.slice.call(e.dataTransfer.items),function(_file){return(0,_attrAccept.default)(_file,_this.props.accept)});case 7:files=_context.sent;_this.uploadFiles(files);_context.next=14;break;case 11:_files=(0,_toConsumableArray2.default)(e.dataTransfer.files).filter(function(file){return(0,_attrAccept.default)(file,_this.props.accept)}),!1===multiple&&(_files=_files.slice(0,1)),_this.uploadFiles(_files);case 14:case "end":return _context.stop()}},
_callee)}));return function(_x){return _ref.apply(this,arguments)}}());(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"uploadFiles",function(files){var originFiles=(0,_toConsumableArray2.default)(files);files=originFiles.map(function(file){file.uid=(0,_uid.default)();return _this.processFile(file,originFiles)});Promise.all(files).then(function(fileList){var onBatchStart=_this.props.onBatchStart;null===onBatchStart||void 0===onBatchStart||onBatchStart(fileList.map(function(_ref2){return{file:_ref2.origin,
parsedFile:_ref2.parsedFile}}));fileList.filter(function(file){return null!==file.parsedFile}).forEach(function(file){_this.post(file)})})});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"processFile",function(){var _ref3=(0,_asyncToGenerator2.default)((0,_regeneratorRuntime2.default)().mark(function _callee2(file,fileList){var beforeUpload,transformedFile,action,mergedAction,data,mergedData,parsedData,parsedFile,mergedParsedFile;return(0,_regeneratorRuntime2.default)().wrap(function(_context2){for(;;)switch(_context2.prev=
_context2.next){case 0:beforeUpload=_this.props.beforeUpload;transformedFile=file;if(!beforeUpload){_context2.next=14;break}_context2.prev=3;_context2.next=6;return beforeUpload(file,fileList);case 6:transformedFile=_context2.sent;_context2.next=12;break;case 9:_context2.prev=9,_context2.t0=_context2["catch"](3),transformedFile=!1;case 12:if(!1!==transformedFile){_context2.next=14;break}return _context2.abrupt("return",{origin:file,parsedFile:null,action:null,data:null});case 14:action=_this.props.action;
if("function"!==typeof action){_context2.next=21;break}_context2.next=18;return action(file);case 18:mergedAction=_context2.sent;_context2.next=22;break;case 21:mergedAction=action;case 22:data=_this.props.data;if("function"!==typeof data){_context2.next=29;break}_context2.next=26;return data(file);case 26:mergedData=_context2.sent;_context2.next=30;break;case 29:mergedData=data;case 30:return parsedData="object"!==(0,_typeof2.default)(transformedFile)&&"string"!==typeof transformedFile||!transformedFile?
file:transformedFile,mergedParsedFile=parsedFile=parsedData instanceof File?parsedData:new File([parsedData],file.name,{type:file.type}),mergedParsedFile.uid=file.uid,_context2.abrupt("return",{origin:file,data:mergedData,parsedFile:mergedParsedFile,action:mergedAction});case 35:case "end":return _context2.stop()}},_callee2,null,[[3,9]])}));return function(_x2,_x3){return _ref3.apply(this,arguments)}}());(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"saveFileInput",function(node){_this.fileInput=
node});return _this}(0,_inherits2.default)(AjaxUploader,_Component);var _super=(0,_createSuper2.default)(AjaxUploader);(0,_createClass2.default)(AjaxUploader,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1;this.abort()}},{key:"post",value:function(_ref4){var _this2=this,origin=_ref4.origin,parsedFile=_ref4.parsedFile;if(this._isMounted){var _this$props2=this.props,onStart=_this$props2.onStart,uid=origin.uid,request=_this$props2.customRequest||
_request.default;_ref4={action:_ref4.action,filename:_this$props2.name,data:_ref4.data,file:parsedFile,headers:_this$props2.headers,withCredentials:_this$props2.withCredentials,method:_this$props2.method||"post",onProgress:function(e){var onProgress=_this2.props.onProgress;null===onProgress||void 0===onProgress||onProgress(e,parsedFile)},onSuccess:function(ret,xhr){var onSuccess=_this2.props.onSuccess;null===onSuccess||void 0===onSuccess||onSuccess(ret,parsedFile,xhr);delete _this2.reqs[uid]},onError:function(err,
ret){var onError=_this2.props.onError;null===onError||void 0===onError||onError(err,ret,parsedFile);delete _this2.reqs[uid]}};onStart(origin);this.reqs[uid]=request(_ref4)}}},{key:"reset",value:function(){this.setState({uid:(0,_uid.default)()})}},{key:"abort",value:function(file){var reqs=this.reqs;file?(file=file.uid?file.uid:file,reqs[file]&&reqs[file].abort&&reqs[file].abort(),delete reqs[file]):Object.keys(reqs).forEach(function(uid){reqs[uid]&&reqs[uid].abort&&reqs[uid].abort();delete reqs[uid]})}},
{key:"render",value:function(){var _this$props3=this.props,Tag=_this$props3.component,prefixCls=_this$props3.prefixCls,className=_this$props3.className,_this$props3$classNam=_this$props3.classNames;_this$props3$classNam=void 0===_this$props3$classNam?{}:_this$props3$classNam;var disabled=_this$props3.disabled,id=_this$props3.id,name=_this$props3.name,style=_this$props3.style,_this$props3$styles=_this$props3.styles;_this$props3$styles=void 0===_this$props3$styles?{}:_this$props3$styles;var multiple=
_this$props3.multiple,accept=_this$props3.accept,capture=_this$props3.capture,children=_this$props3.children,directory=_this$props3.directory,openFileDialogOnClick=_this$props3.openFileDialogOnClick,onMouseEnter=_this$props3.onMouseEnter,onMouseLeave=_this$props3.onMouseLeave,hasControlInside=_this$props3.hasControlInside;_this$props3=(0,_objectWithoutProperties2.default)(_this$props3,_excluded);prefixCls=(0,_classnames.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)({},
prefixCls,!0),"".concat(prefixCls,"-disabled"),disabled),className,className));className=directory?{directory:"directory",webkitdirectory:"webkitdirectory"}:{};return _react.default.createElement(Tag,(0,_extends2.default)({},disabled?{}:{onClick:openFileDialogOnClick?this.onClick:function(){},onKeyDown:openFileDialogOnClick?this.onKeyDown:function(){},onMouseEnter,onMouseLeave,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:hasControlInside?void 0:"0"},{className:prefixCls,role:hasControlInside?
void 0:"button",style}),_react.default.createElement("input",(0,_extends2.default)({},(0,_pickAttrs.default)(_this$props3,{aria:!0,data:!0}),{id,name,disabled,type:"file",ref:this.saveFileInput,onClick:function(e){return e.stopPropagation()},key:this.state.uid,style:(0,_objectSpread2.default)({display:"none"},_this$props3$styles.input),className:_this$props3$classNam.input,accept},className,{multiple,onChange:this.onChange},null!=capture?{capture}:{})),children)}}]);return AjaxUploader}(_react.Component);
exports.default=require}
//# sourceMappingURL=module$node_modules$rc_upload$lib$AjaxUploader.js.map
