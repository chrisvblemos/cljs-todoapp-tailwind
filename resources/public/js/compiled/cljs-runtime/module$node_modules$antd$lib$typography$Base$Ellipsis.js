shadow$provide.module$node_modules$antd$lib$typography$Base$Ellipsis=function(global,require,module,exports){function sliceNodes(nodeList,len){let currLen=0;const currentNodeList=[];for(let i=0;i<nodeList.length;i+=1){if(currLen===len)return currentNodeList;const node=nodeList[i];var nodeLen=(0,_util.isValidText)(node)?String(node).length:1;nodeLen=currLen+nodeLen;if(nodeLen>len)return currentNodeList.push(String(node).slice(0,len-currLen)),currentNodeList;currentNodeList.push(node);currLen=nodeLen}return nodeList}
"use client";global=require("module$node_modules$$babel$runtime$helpers$interopRequireWildcard").default;module=require("module$node_modules$$babel$runtime$helpers$interopRequireDefault").default;Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(props){const {enableMeasure,width,text,children,rows,expanded,miscDeps,onEllipsis}=props,nodeList=React.useMemo(()=>(0,_toArray.default)(text),[text]),nodeLen=React.useMemo(()=>getNodesLen(nodeList),[text]);props=React.useMemo(()=>
children(nodeList,!1),[text]);const [ellipsisCutIndex,setEllipsisCutIndex]=React.useState(null),cutMidRef=React.useRef(null),measureWhiteSpaceRef=React.useRef(null),needEllipsisRef=React.useRef(null),descRowsEllipsisRef=React.useRef(null),symbolRowEllipsisRef=React.useRef(null),[canEllipsis,setCanEllipsis]=React.useState(!1),[needEllipsis,setNeedEllipsis]=React.useState(0),[ellipsisHeight,setEllipsisHeight]=React.useState(0),[parentWhiteSpace,setParentWhiteSpace]=React.useState(null);(0,_useLayoutEffect.default)(()=>
{enableMeasure&&width&&nodeLen?setNeedEllipsis(1):setNeedEllipsis(0)},[width,text,rows,enableMeasure,nodeList]);(0,_useLayoutEffect.default)(()=>{var _a,_b,_c;if(1===needEllipsis){setNeedEllipsis(2);var _d=measureWhiteSpaceRef.current&&getComputedStyle(measureWhiteSpaceRef.current).whiteSpace;setParentWhiteSpace(_d)}else if(2===needEllipsis){const isOverflow=!(null===(_a=needEllipsisRef.current)||void 0===_a||!_a.isExceed());setNeedEllipsis(isOverflow?3:4);setEllipsisCutIndex(isOverflow?[0,nodeLen]:
null);setCanEllipsis(isOverflow);_a=(null===(_b=needEllipsisRef.current)||void 0===_b?void 0:_b.getHeight())||0;_b=1===rows?0:(null===(_c=descRowsEllipsisRef.current)||void 0===_c?void 0:_c.getHeight())||0;_c=(null===(_d=symbolRowEllipsisRef.current)||void 0===_d?void 0:_d.getHeight())||0;setEllipsisHeight(Math.max(_a,_b+_c)+1);onEllipsis(isOverflow)}},[needEllipsis]);const cutMidIndex=ellipsisCutIndex?Math.ceil((ellipsisCutIndex[0]+ellipsisCutIndex[1])/2):0;(0,_useLayoutEffect.default)(()=>{var _a;
const [minIndex,maxIndex]=ellipsisCutIndex||[0,0];if(minIndex!==maxIndex){const isOverflow=((null===(_a=cutMidRef.current)||void 0===_a?void 0:_a.getHeight())||0)>ellipsisHeight;_a=cutMidIndex;1===maxIndex-minIndex&&(_a=isOverflow?minIndex:maxIndex);setEllipsisCutIndex(isOverflow?[minIndex,_a]:[_a,maxIndex])}},[ellipsisCutIndex,cutMidIndex]);const finalContent=React.useMemo(()=>{if(!enableMeasure)return children(nodeList,!1);if(3!==needEllipsis||!ellipsisCutIndex||ellipsisCutIndex[0]!==ellipsisCutIndex[1]){const content=
children(nodeList,!1);return[4,0].includes(needEllipsis)?content:React.createElement("span",{style:Object.assign(Object.assign({},lineClipStyle),{WebkitLineClamp:rows})},content)}return children(expanded?nodeList:sliceNodes(nodeList,ellipsisCutIndex[0]),canEllipsis)},[expanded,needEllipsis,ellipsisCutIndex,nodeList].concat((0,_toConsumableArray2.default)(miscDeps))),measureStyle={width,margin:0,padding:0,whiteSpace:"nowrap"===parentWhiteSpace?"normal":"inherit"};return React.createElement(React.Fragment,
null,finalContent,2===needEllipsis&&React.createElement(React.Fragment,null,React.createElement(MeasureText,{style:Object.assign(Object.assign(Object.assign({},measureStyle),lineClipStyle),{WebkitLineClamp:rows}),ref:needEllipsisRef},props),React.createElement(MeasureText,{style:Object.assign(Object.assign(Object.assign({},measureStyle),lineClipStyle),{WebkitLineClamp:rows-1}),ref:descRowsEllipsisRef},props),React.createElement(MeasureText,{style:Object.assign(Object.assign(Object.assign({},measureStyle),
lineClipStyle),{WebkitLineClamp:1}),ref:symbolRowEllipsisRef},children([],!0))),3===needEllipsis&&ellipsisCutIndex&&ellipsisCutIndex[0]!==ellipsisCutIndex[1]&&React.createElement(MeasureText,{style:Object.assign(Object.assign({},measureStyle),{top:400}),ref:cutMidRef},children(sliceNodes(nodeList,cutMidIndex),!0)),1===needEllipsis&&React.createElement("span",{style:{whiteSpace:"inherit"},ref:measureWhiteSpaceRef}))};var _toConsumableArray2=module(require("module$node_modules$$babel$runtime$helpers$toConsumableArray")),
React=global(require("module$node_modules$react$index")),_toArray=module(require("module$node_modules$rc_util$lib$Children$toArray")),_useLayoutEffect=module(require("module$node_modules$rc_util$lib$hooks$useLayoutEffect")),_util=require("module$node_modules$antd$lib$typography$Base$util");const MeasureText=React.forwardRef((_ref,ref)=>{let {style,children}=_ref;const spanRef=React.useRef(null);React.useImperativeHandle(ref,()=>({isExceed:()=>{const span=spanRef.current;return span.scrollHeight>span.clientHeight},
getHeight:()=>spanRef.current.clientHeight}));return React.createElement("span",{"aria-hidden":!0,ref:spanRef,style:Object.assign({position:"fixed",display:"block",left:0,top:0,pointerEvents:"none",backgroundColor:"rgba(255, 0, 0, 0.65)"},style)},children)}),getNodesLen=nodeList=>nodeList.reduce((totalLen,node)=>totalLen+((0,_util.isValidText)(node)?String(node).length:1),0),lineClipStyle={display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical"}}
//# sourceMappingURL=module$node_modules$antd$lib$typography$Base$Ellipsis.js.map
